"use strict";!function(){getCookie("登录成功")?alert("欢迎访问"):(alert("请先登录"),location.href="../html/login.html");var r=document.querySelector("tbody"),o=document.querySelector("thead"),e=document.querySelector(".panel-body"),t=document.querySelector("#dele");function i(){var t=(JSON.parse(localStorage.getItem("shoppingCart"))||[]).filter(function(t){return t.isSelected}).reduce(function(t,e){return t+ +e.group_price*e.number},0);e.innerHTML="￥"+t/100}function a(){var t=JSON.parse(localStorage.getItem("shoppingCart"))||[],e=t.every(function(t){return t.isSelected});o.innerHTML='\n        <tr class="trTitle">\n            <th class=" text-center"> <input '+(e?"checked":"")+'  type="checkbox">全选 </th>\n            <th class=" text-center">商品</th>\n            <th class=" text-center">商品信息</th>\n            <th class=" text-center">商品价格</th>\n            <th class=" text-center">商品数量</th>\n            <th class=" text-center">小计(元)</th>\n            <th class=" text-center">操作</th>\n        </tr>\n        ';var n="";t.forEach(function(t){n+='<tr class="trList">\n                <td><input class = "ppp" '+(t.isSelected?"checked":"")+' data-id="'+t.goods_id+'" type="checkbox"></td>\n                <td><img style = "width:100px;hegiht:100px" alt="Responsive image" src="'+t.hd_thumb_url+'"></td>\n                <td>'+t.goods_name+"</td>\n                <td>￥"+t.group_price/100+'</td>\n                <td>\n                    <button data-id="'+t.goods_id+'" class="button">+</button>\n                    '+t.number+'\n                    <button data-id="'+t.goods_id+'" class="button">-</button>\n                </td>\n                <td> ￥'+t.group_price/100*t.number+' </td>\n                <td>\n                  <button data-id="'+t.goods_id+'" class="delBtn">删除</button>\n                </td>\n            </tr>\n        '}),r.innerHTML=n}a(),i(),t.onclick=function(){window.localStorage.clear(),a(),i()},o.onclick=function(t){if("INPUT"==t.target.tagName){var e=t.target.checked,n=JSON.parse(localStorage.getItem("shoppingCart"));n.forEach(function(t){t.isSelected=e}),localStorage.setItem("shoppingCart",JSON.stringify(n)),i(),a()}},r.onclick=function(t){var e=JSON.parse(localStorage.getItem("shoppingCart"));if("INPUT"===t.target.tagName){var n=t.target.getAttribute("data-id");console.log("选中一条id为"+n+"的数据"),(r=e.find(function(t){return t.goods_id==n})).isSelected=t.target.checked,localStorage.setItem("shoppingCart",JSON.stringify(e)),i(),a()}else if("+"===t.target.innerHTML){n=t.target.getAttribute("data-id");(r=e.find(function(t){return t.goods_id==n})).number++,localStorage.setItem("shoppingCart",JSON.stringify(e)),a(),i()}else if("-"===t.target.innerHTML){n=t.target.getAttribute("data-id");(r=e.find(function(t){return t.goods_id==n})).number--,r.number<1&&(r.number=1),localStorage.setItem("shoppingCart",JSON.stringify(e)),a(),i()}else if("删除"===t.target.innerHTML){n=t.target.getAttribute("data-id");var r=e.find(function(t){return t.goods_id==n}),o=e.indexOf(r);console.log(o),e.splice(o,1),localStorage.setItem("shoppingCart",JSON.stringify(e)),a(),i()}}}();